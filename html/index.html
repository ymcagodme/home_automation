<!DOCTYPE html>
<html>
    <head>
        <title>Cloud Control System</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script type="text/javascript" src="/webiopi.js"></script>
        <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <script type="text/javascript" src="js/materialize.min.js"></script>
    </head>
    <body>
        <div class="container">
            <h1>Cloud Controller</h1>
            <div class="row">
                <div class="col s12 m12 l6">
                  <div class="card right-align">
                    <div class="card-content center teal white-text">
                        <h5>4F 電燈</h5>
                    </div>
                    <div class="card-image">
                      <img src="http://admin:132456@huangsoon.ddns.net:8080/cgi-bin/net_jpeg.cgi?ch=10" id="4f_cam">
                      <span class="card-title" id="4f_osd">12/25/2014, 1:32:12 PM</span>
                    </div>
                    <div class="card-action">
                        <a class="waves-effect waves-light btn-large white-text" id="gpio10">
                            <i class="mdi-action-settings-power right"></i>power
                        </a>
                    </div>
                  </div>
                </div>

                <div class="col s12 m12 l6">
                  <div class="card right-align">
                    <div class="card-content center teal white-text">
                        <h5>1F 鐵捲門</h5>
                    </div>
                    <div class="card-image">
                      <img src="http://admin:132456@huangsoon.ddns.net:8080/cgi-bin/net_jpeg.cgi?ch=0" id="1f_cam">
                      <span class="card-title" id="1f_osd">12/25/2014, 1:32:12 PM</span>
                    </div>
                    <div class="card-action">

                        <a class="waves-effect waves-light btn-floating green"><i class="mdi-action-settings-power"></i></a>
                        <a class="waves-effect waves-light btn-floating green"><i class="mdi-hardware-keyboard-arrow-up"></i></a>
                        <a class="waves-effect waves-light btn-floating green"><i class="mdi-av-stop"></i></a>
                        <a class="waves-effect waves-light btn-floating green"><i class="mdi-hardware-keyboard-arrow-down"></i></a>
                    </div>
                  </div>
                </div>
            </div>
        </div>

        <script>
            $(document).ready(function() {
                console.log("jQuery is ready!");
                $("#4f_cam").load(function() {
                    var d = new Date();
                    var url = 'http://admin:132456@huangsoon.ddns.net:8080/cgi-bin/net_jpeg.cgi?ch=10&time=' + d.getTime();
                    $("#4f_cam").attr('src', url)
                    $("#4f_osd").html(d.toLocaleString());
                });

                $("#1f_cam").load(function() {
                    var d = new Date();
                    var url = 'http://admin:132456@huangsoon.ddns.net:8080/cgi-bin/net_jpeg.cgi?ch=0&time=' + d.getTime();
                    $("#1f_cam").attr('src', url)
                    $("#1f_osd").html(d.toLocaleString());
                });
            });


            webiopi().ready(function() {
                    var lightPIN = 10;
                    var powerPIN = 24;
                    var upPIN = 25;
                    var stopPIN = 8;
                    var downPIN = 7;


                    // Set GPIO in OUTPUT mode
                    webiopi().setFunction(lightPIN, "OUT");
                    webiopi().setFunction(powerPIN, "OUT");
                    webiopi().setFunction(upPIN, "OUT");
                    webiopi().setFunction(stopPIN, "OUT");
                    webiopi().setFunction(downPIN, "OUT");

                    var toggle_with_callback = function(gpio, callback) {
                        var value = (webiopi().GPIO[gpio].value == 1) ? 0 : 1;
                        webiopi().digitalWrite(gpio, value);

                        if (callback != undefined) {
                            callback(gpio);
                        }
                    };

                    $("#4f_light").on("click", function() {
                        console.log("4F light action!");
                        toast("[Power Switch] 4F Light", 2000);
                        toggle_with_callback(lightPIN, function() {
                            toast("[Success] 4F Light");
                        });
                    });

                    var light_button = webiopi().createGPIOButton(lightPIN, "4F Light");
                    var power_button = webiopi().createSequenceButton("power_button", "Power", powerPIN, 500, "010");
                    var up_button = webiopi().createSequenceButton("up_button", "Up", upPIN, 500, "010");
                    var stop_button = webiopi().createSequenceButton("stop_button", "Stop", stopPIN, 500, "010");
                    var down_button = webiopi().createSequenceButton("down_button", "Down", downPIN, 500, "010");

                    // Append button to HTML element with ID="controls" using jQuery
                    // $("#light_control").append(light_button);
                    // $("#door_control").append(power_button);
                    // $("#door_control").append(up_button);
                    // $("#door_control").append(stop_button);
                    // $("#door_control").append(down_button);
                    // $("#debug").html("Loaded!");

                    // Refresh GPIO buttons
                    // pass true to refresh repeatedly of false to refresh once
                    // Overwrite the default update function to add class
                    webiopi().updateValue = function(gpio, value) {
                        w().GPIO[gpio].value = value;
                        if (value == 1) {
                            $("#gpio"+gpio).removeClass("grey");
                            $("#gpio"+gpio).addClass("green");
                        } else {
                            $("#gpio"+gpio).removeClass("green");
                            $("#gpio"+gpio).addClass("grey");
                        }
                    };
                    webiopi().refreshGPIO(true);
            });

        </script>
            <style type="text/css">
                    button {
                            display: block;
                            margin: 5px 5px 5px 5px;
                            width: 80%;
                            height: 50px;
                            font-size: 24pt;
                            font-weight: bold;
                            color: white;
                    }

                    #gpio17.LOW {
                            background-color: Black;
                    }

                    #gpio17.HIGH {
                            background-color: Blue;
                    }
            </style>
    </body>
</html>
